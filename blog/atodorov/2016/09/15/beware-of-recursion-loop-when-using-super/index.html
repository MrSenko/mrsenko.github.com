<!DOCTYPE HTML>
<html>
	<head>
                    <script src="https://cdn.optimizely.com/js/5899451178.js"></script>
		<title>Beware of recursion loop when using super()</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="keywords" content="" />
                <meta name="google-site-verification" content="fDhfvNtsr-Oqa-_-cJ_1viTvXhEWDFXRDC8oZnXV-To" />
		<!--[if lte IE 8]><script src="/theme/js/html5shiv.js"></script><![endif]-->
		<script src="/theme/js/jquery.min.js"></script>
		<script src="/theme/js/skel.min.js"></script>
		<script src="/theme/js/skel-layers.min.js"></script>
                <script src="/js/list-v1.2.0.min.js"></script>
<script>
/*
	Spatial by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
*/

(function($) {

	skel.init({
		reset: 'full',
		breakpoints: {
			global: {
				href: '/theme/css/style.css',
				containers: 1400,
				grid: { gutters: ['2em', 0] }
			},
			xlarge: {
				media: '(max-width: 1680px)',
				href: '/theme/css/style-xlarge.css',
				containers: 1200
			},
			large: {
				media: '(max-width: 1280px)',
				href: '/theme/css/style-large.css',
				containers: 960,
				grid: { gutters: ['1.5em', 0] },
				viewport: { scalable: false }
			},
			medium: {
				media: '(max-width: 980px)',
				href: '/theme/css/style-medium.css',
				containers: '90%!'
			},
			small: {
				media: '(max-width: 736px)',
				href: '/theme/css/style-small.css',
				containers: '90%!',
				grid: { gutters: ['1.25em', 0] }
			},
			xsmall: {
				media: '(max-width: 480px)',
				href: '/theme/css/style-xsmall.css'
			}
		},
		plugins: {
			layers: {
				navPanel: {
					animation: 'pushX',
					breakpoints: 'medium',
					clickToHide: true,
					height: '100%',
					hidden: true,
					html: '<div data-action="moveElement" data-args="nav"></div>',
					orientation: 'vertical',
					position: 'top-left',
					side: 'left',
					width: 250
				},
				navButton: {
					breakpoints: 'medium',
					height: '4em',
					html: '<span class="toggle" data-action="toggleLayer" data-args="navPanel"></span>',
					position: 'top-left',
					side: 'top',
					width: '6em'
				}
			}
		}
	});

	$(function() {

		var	$window = $(window),
			$body = $('body');

		// Disable animations/transitions until the page has loaded.
			$body.addClass('is-loading');

			$window.on('load', function() {
				$body.removeClass('is-loading');
			});

		// Touch mode.
			if (skel.vars.isMobile)
				$body.addClass('is-touch');

	});

})(jQuery);
</script>		<noscript>
			<link rel="stylesheet" href="/theme/css/skel.css" />
			<link rel="stylesheet" href="/theme/css/style.css" />
			<link rel="stylesheet" href="/theme/css/style-xlarge.css" />
		</noscript>

                <!-- Code highlight color scheme -->
                    <link href="/theme/css/code_blocks/github.css" rel="stylesheet">



        <meta name="description" content="use super(ClassName, self) & pylint" >

        <meta name="author" content="Alexander Todorov">

        <meta name="tags" content="Python" >
        <meta name="tags" content="QA" >

        <meta name="twitter:site" content="@Mr_Senko">
        <meta name="twitter:title" content="Beware of recursion loop when using super()">
            <meta name="twitter:description" content="use super(ClassName, self) & pylint">
        <meta name="twitter:card" content="summary_large_image">
            <meta name="twitter:image" content="/theme/images/twitter_card.jpg">


        <meta property="og:site_name" content="Mr. Senko - Open Source Wizards">
        <meta property="og:type" content="article" />
            <meta property="article:author" content="/blog/atodorov/" />
        <meta property="og:url" content="/blog/atodorov/2016/09/15/beware-of-recursion-loop-when-using-super/" />
        <meta property="og:title" content="Beware of recursion loop when using super()" />
        <meta property="article:published_time" content="2016-09-15 13:00:00+03:00">
            <meta property="og:description" content="use super(ClassName, self) & pylint">

            <meta property="og:image" content="/theme/images/og_image.jpg">
	</head>
	<body class="landing">

		<!-- Header -->
			<header id="header" class="alt">
                            <a href="/">
				<img src="/theme/images/logo.png" />
                            </a>
				<nav id="nav">
					<ul>
						<li><strong><a href="/#subscriptions">Plans & Pricing</a></strong></li>
						<li><strong><a href="/#software">Supported software</a></strong></li>
						<li><strong><a href="/blog/">Blog</a></strong></li>
						<li><strong><a class="fa fa-twitter" href="https://twitter.com/Mr_Senko"></a></strong></li>
					</ul>
				</nav>
			</header>

            <section id="banner">
    <h2>Beware of recursion loop when using super()</h2>
    <p>use super(ClassName, self) & pylint</p>
    <p>
        <em>Posted by
                <a href="/blog/atodorov/">Alexander Todorov</a>
            <br/>on Thu 15 September 2016
        </em>
    </p>
            </section>

<section id="#article" class="wrapper style1">
    <div class="container">
    <p>When working with class inheritance in Python you often find yourself using
<code>super()</code> to call the parent class methods. The format is</p>
<div class="highlight"><pre><span></span><span class="nb">super</span><span class="p">([</span><span class="n">current</span> <span class="k">class</span> <span class="nc">name</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="p">[</span><span class="n">base</span> <span class="k">class</span> <span class="nc">method</span><span class="p">]([</span><span class="n">arguments</span><span class="p">])</span>
</pre></div>


<p>When you have lots of similar code you may be tempted to short-cut the writing
of <code>current class name</code>. The two possibilities are</p>
<div class="highlight"><pre><span></span><span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">some_method</span><span class="p">()</span>
<span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">some_method</span><span class="p">()</span>
</pre></div>


<p>I have seen this in production code. I'm guilty myself as well because I like
to use the <code>self.__class__</code> notation! This leads to problems, see
<a href="https://github.com/chartit/django-chartit/issue/41">django-chartit #41</a>, when
you inherit from the class which uses these shortcuts. For example</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="s1">&#39;original&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>

<span class="k">class</span> <span class="nc">Derived</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;derived&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
        <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
        <span class="c1"># super(self.__class__, self).method()</span>

<span class="k">class</span> <span class="nc">Subclass</span><span class="p">(</span><span class="n">Derived</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;subclass of derived&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Subclass</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
</pre></div>


<p>When you call <code>Derived().method()</code> the result is </p>
<div class="highlight"><pre><span></span>derived &lt;class &#39;__main__.Derived&#39;&gt; &lt;class &#39;__main__.Derived&#39;&gt;
original &lt;class &#39;__main__.Derived&#39;&gt; &lt;class &#39;__main__.Derived&#39;&gt;
</pre></div>


<p>Here both shortcuts are evaluated correctly. However when you call
<code>Subclass().method()</code> the result becomes</p>
<div class="highlight"><pre><span></span>subclass of derived &lt;class &#39;__main__.Subclass&#39;&gt; &lt;class &#39;__main__.Subclass&#39;&gt;
derived &lt;class &#39;__main__.Subclass&#39;&gt; &lt;class &#39;__main__.Subclass&#39;&gt;
derived &lt;class &#39;__main__.Subclass&#39;&gt; &lt;class &#39;__main__.Subclass&#39;&gt;
derived &lt;class &#39;__main__.Subclass&#39;&gt; &lt;class &#39;__main__.Subclass&#39;&gt;
... skip ...
RuntimeError: maximum recursion depth exceeded while calling a Python object
</pre></div>


<p>In the example, the <em>method resolution order</em> for <code>Subclass</code> is
[<code>Subclass</code>, <code>Derived</code>, <code>Base</code>] and <code>super()</code> needs to know where to start searching
for any overridden methods. The call <code>super(Subclass)</code> works fine and invokes
<code>Derived.method()</code> as expected. Then we call <code>super(Subclass)</code> inside <code>Derived.method()</code>
which leads back to where we were hence the recursion loop. The problem is only visible
when you have other classes that inherit from the faulty class (a class which uses incorrect
invocation of <code>super()</code>). This is why it may lay hidden in production software!</p>
<p>I definitely expected a severe code smell like that to be discovered by pylint
and Landscape.io. Indeed older versions (pylint-1.3.1-1.el7.noarch) will report
error for <code>super(type(self))</code> but not newer ones. As it turns out pylint didn't
have an explicit test for this condition and have introduced a regression in the
master branch. I believe this is due to that fact that they didn't check for
using <code>type()</code> explicitly but rather that was a side effect.
<a href="https://github.com/PyCQA/pylint/pull/1109">Pylint#1109</a> adds explicit tests for
the two code smells described above and updates the checkers to explicitly
detect them! Happy testing!</p>
<p>I hope you like my work and please
<strong><a href="/subscribe.html">subscribe to Mr. Senko's support service</a></strong>
should you need commercial support for this or other open source libraries!</p>

    <div class="post-meta">
        <p>
        Posted by
            <a href="/blog/atodorov/">Alexander Todorov</a>
        on Thu 15 September 2016
        </p>
    </div>

        <div class="tags">
            <p>tags: <a href="/blog/tags/python/">Python</a>, <a href="/blog/tags/qa/">QA</a>, </p>
        </div>
    </div>


    <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-568b9305e58615ff"></script>
		<!-- Footer -->
			<footer id="footer">
				<div class="container">
					<ul class="icons">
						<li><a href="https://github.com/MrSenko" class="icon fa fa-github"></a></li>
						<li><a href="https://twitter.com/Mr_Senko" class="icon fa fa-twitter"></a></li>
						<li><a href="https://bitbucket.org/MrSenko" class="icon fa fa-bitbucket"></a></li>
					</ul>
					<ul class="copyright">
						<li>&copy; 2016 Mr. Senko, Ltd.</li>
					</ul>
				</div>
			</footer>

	</body>
</html>